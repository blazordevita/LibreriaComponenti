@page "/fetchdata"
@inject IWeatherForecastService WeatherForecastService

<PageTitle>Weather forecast</PageTitle>

<h1>Weather forecast</h1>

<p>This component demonstrates fetching data from the server.</p>

@if (WeatherForecastModel.Rows == null)
{
    <p><em>Loading...</em></p>
}
else
{
    @if (newWeatherForecast == null)
    {
        <button class="btn btn-primary mb-3" @onclick="CreateWeatherForecast">
            Create Weather Forecast
        </button>
        <Grid Model="WeatherForecastModel" />
    }
    else
    {
        <Details TItem="WeatherForecast"  Item="newWeatherForecast" OnCancel="Cancel" OnSave="Save">
            <FormFields Context="weather">
            <div class="form-group">
                <label for="Date">Date:</label>
                <InputDate id="Date" @bind-Value="weather.Date" class="form-control" />
                <ValidationMessage For="@(() => weather.Date)" />
            </div>

            <div class="form-group">
                <label for="Temperature">Temperature:</label>
                <InputNumber id="Temperature" @bind-Value="weather.TemperatureC" class="form-control" />
                <ValidationMessage For="@(() => weather.TemperatureC)" />
            </div>

            <div class="form-group">
                <label for="Summary">Summary:</label>
                <InputTextArea id="Summary" @bind-Value="weather.Summary" class="form-control" />
                <ValidationMessage For="@(() => weather.Summary)" />
            </div>
            </FormFields>
        </Details>
    }
}
@code {
    private GridModel WeatherForecastModel = new GridModel();
    private WeatherForecast? newWeatherForecast;
    private WeatherForecast?[] weatherForecasts;
    public void CreateWeatherForecast()
    {
        newWeatherForecast = new WeatherForecast();
    }

    public void Cancel()
    {
        newWeatherForecast = null;
    }

    public void Save()
    {
        Array.Resize(ref weatherForecasts, weatherForecasts.Length + 1);
        weatherForecasts[weatherForecasts.Length - 1] = newWeatherForecast;
        WeatherForecastModel.Rows = weatherForecasts;
        newWeatherForecast = null;
    }

    protected override async Task OnInitializedAsync()
    {
        WeatherForecastModel.UseAnnotations = true;
        weatherForecasts = await WeatherForecastService.GetForecastAsync(DateTime.Now);
        WeatherForecastModel.Rows = weatherForecasts;
    }
}
